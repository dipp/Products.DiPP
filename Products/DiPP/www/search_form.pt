<p tal:replace="structure here/manage_page_header" omit-tag="">Header</p>
<h2 tal:define="manage_tabs_message options/manage_tabs_message | nothing"
    tal:replace="structure here/manage_tabs">Tabs</h2>

<h3>Search the repository</h3>

<form tal:condition="here/label"
      action="manage_search_form"
      tal:define="fields python:('pid','cDate','mDate','title');
                  comparisions python:(('has','contains'),('eq','equals'),('lt','less'),('le','less or equal'),('gt','greater'),('ge','greater or equal'))">
    <input name="field:list"      type="hidden" value="label">
    <input name="comparison:list" type="hidden" value="has">
    <input name="value:list"      type="hidden" value="" tal:attributes="value here/label">
    
    <input name="field:list"      type="hidden" value="cModel">
    <input name="comparison:list" type="hidden" value="has">
    <input name="value:list"      type="hidden" value="DiPP:article">
    
    <tal:block tal:repeat="opt python:range(3)">
        <select name="field:list">
            <option value="0">Select a field</option>
            <tal:block tal:repeat="field fields">
                <option value="" tal:attributes="value field" tal:content="field"></option>
            </tal:block>
        </select>
        <select name="comparison:list">
            <tal:block tal:repeat="comparision comparisions">
                <option value="" tal:attributes="value python:comparision[0]" tal:content="python:comparision[1]"></option>
            </tal:block>
        </select>
        <input name="value:list" type="text" value="" /><br />
    </tal:block>
    
    <input type="submit" value="OK">
    <input type="reset" value="Cancel">
</form>

<p>
    This form can be used to find and delete Article, which have been deleted in Plone, but
    still exist in the Fedora Repository. By using this form not only the object representing the article
    (dipp:???) but also the objects containing the actual texts, images,... (content:???) are 
    purged from the repository.
</p>

<div tal:define="field request/field|nothing;
                 comparison request/comparison|nothing;
                 value request/value|nothing" >

    <tal:block tal:condition="python: field!=None and comparison!=None and value!=None">
        <tal:block  tal:define="results python:here.manage_search(field=field,comparison=comparison,value=value);
                                PIDs python:here.getFedoraArticles()">
            <form action="manage_deleteObjectForm"
                  tal:attributes="action python:here.absolute_url()+'/manage_deleteObjectForm'"
                  method="POST"
                  tal:define="format here/portal_properties/site_properties/localLongTimeFormat">
                <table border="0" cellpadding="2" cellspacing="0" width="98%">
                    <tr class="list-header">
                        <th align="left" width="16">&nbsp;</th>
                        <th align="left">PID</th>
                        <th align="left">state</th>
                        <th align="left">publisher</th>
                        <th align="left">Plone</th>
                        <th align="left">cDate</th>
                        <th align="left">cModel</th>
                        <th align="left">Title</th>
                    </tr>
                    <tal:block tal:repeat="result results">
                        <tr tal:define="PID result/PID;
                                        cModel result/cModel"
                            tal:attributes="class python:test(path('repeat/result/even'), 'row-hilite', 'row-normal')">
                            <td width="16">
                                <input tal:condition="python: cModel == 'DiPP:article'" type="checkbox" name="PIDs:list" value="" tal:attributes="value result/PID">
                            </td>
                            <td tal:content="PID"></td>
                            <td tal:content="result/state"></td>
                            <td tal:content="python:result['publisher'][0]"></td>
                            <td>
                                <span tal:condition="python: PID in PIDs">
                                yes
                                </span>
                                <span tal:condition="python: PID not in PIDs">
                                no
                                </span>
                            </td>
                            <td tal:content="python: result['cDate']"></td>
                            <td tal:content="cModel"></td>
                            <td>
                                <abbr tal:attributes="title string: ${result/creator}: ${result/title}"
                                      tal:content="python:result['title'][0:40] + '...'"></abbr>
                            </td>
                        </tr>
                    </tal:block>
                </table>
                <input type="submit" value="delete">
            </form>
        </tal:block>
    </tal:block>
</div>
<p tal:replace="structure here/manage_page_footer" omit-tag="">Footer</p>

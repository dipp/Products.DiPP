<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      i18n:domain="plone">

    <body>
        
        <!-- language -->
        <div metal:define-macro="language"
             class="field"
             tal:define="error errors/language|nothing;
                         languages request/language|python:qdc['language']"
             tal:attributes="class python:test(error, 'field error', 'field')"
             i18n:domain="qdc">

            <label for="language" i18n:domain="qdc"  i18n:translate="label_language">sprache</label>
            <span class="fieldRequired" title="Required"
                   i18n:attributes="title"
                   i18n:domain="plone"
                   i18n:translate="label_required">(Required)</span>
            <div tal:content="error">Validation error output</div>
            <div class="formHelp" i18n:translate="help_language">
                In welcher Sprache ist der Artikel verfasst?
            </div>
            <select name="language:list">
                <option i18n:translate="" value="">---Sprache---</option>
                <tal:block tal:repeat="language available_languages">
                    <option tal:attributes="value language;
                                            selected python: language in languages"
                            tal:content="python:all_languages[language]">ger</option> 
                </tal:block>
            </select>
        </div>

        <!-- ISSN -->
        <div metal:define-macro="issn"
             class="field"
             tal:define="error errors/identifierISSN|nothing;
                         identifierISSN request/identifierISSN|python:qdc['identifierISSN']"
             tal:attributes="class python:test(error, 'field error', 'field')"
             i18n:domain="qdc">

            <label for="identifierISSN" i18n:translate="label_ISSN">ISSN</label>
            
            <span class="fieldRequired" title="Required"
                   i18n:attributes="title"
                   i18n:domain="plone"
                   i18n:translate="label_required">(Required)</span>
            
            <div tal:content="error">Validation error output</div>
            
            <div class="formHelp" i18n:translate="help_issn">
                International Standard Serial Number
            </div>
            
            <input type="text" name="identifierISSN" tal:attributes="value identifierISSN" />
        
        </div>

        <!-- Publisher -->
        <div metal:define-macro="publisher"
             class="field"
             tal:define="error errors/publisher|nothing;
                         publishers request/publisher|python:qdc['publisher']"
             tal:attributes="class python:test(error, 'field error', 'field')"
             i18n:domain="qdc">

            <label for="publisher" i18n:translate="label_publisher">Publisher</label>
            
            <div tal:content="error">Validation error output</div>
            
            <div class="formHelp" i18n:translate="help_publisher">
                Zitat ais Datasite manual
            </div>
            
            <tal:block tal:repeat="publisher publishers">
                <input class="publisher" type="text" name="publisher:list" value="" tal:attributes="value publisher " >
            </tal:block>

        </div>

        <!-- URL -->
        <div metal:define-macro="url"
             class="field"
             tal:define="error errors/identifierURL|nothing;
                         identifierURL request/identifierURL|python:qdc['identifierURL']"
             tal:attributes="class python:test(error, 'field error', 'field')"
             i18n:domain="qdc">

            <label for="language" i18n:translate="label_URL">URL</label>
            <span class="fieldRequired" title="Required"
                   i18n:attributes="title"
                   i18n:domain="plone"
                   i18n:translate="label_required">(Required)</span>
            <div tal:content="error">Validation error output</div>
            <input class="identifierURL" type="text" name="identifierURL" tal:attributes="value identifierURL" />
        </div>
    
        <!-- DDC --> 
        <div metal:define-macro="ddc"
             class="field"
             tal:define="error errors/DDC|nothing;
                         meta_id string:ddc;
                         DDCs request/DDC|python:qdc['DDC'];
                         DDCList python:here.DDCList"
             tal:attributes="class python:test(error, 'field error', 'field');
                             id meta_id"
             i18n:domain="qdc">

            <label for="DDC">
                <span i18n:translate="label_ddc">DDC</span>
                <a class="permalink" 
                   href="#"
                   tal:attributes="href string:${template_id}#${meta_id}"
                   i18n:attributes="title title_permalink"
                   title="Permalink für diese Überschrift">¶</a>
            </label>

            <span class="fieldRequired" title="Required"
                   i18n:attributes="title"
                   i18n:domain="plone"
                   i18n:translate="label_required">(Required)</span>
            <div tal:content="error">Validation error output</div>
            
            <div class="formHelp" i18n:translate="help_ddc">
                Die ersten drei Ebenen der <span i18n:name="ddc-link"><a i18n:translate="dewey_decimal_classification" href="http://dewey.info/">Dewey Decimal Classification</a></span> sind online verfügbar. 
            </div>
            
            <table class="listing nosort metadata">
            <thead>
                <tr>
                    <th></th>
                    <th i18n:translate="label_ddc">DDC</th>
                </tr>
            </thead>
            <tbody>
                <tr tal:repeat="DDC DDCs" 
                    tal:attributes="class python:test(path('repeat/DDC/even'), 'even', 'odd');
                                    id string:${meta_id}_${repeat/DDC/index}">
                    <td>
                        <input type="checkbox" 
                               class="noborder counter"
                               name="ddc_index:int:list" 
                               value=""
                               tal:attributes="value repeat/DDC/index"/>
                    </td>
                    <td>
                        <select name="DDC:list">
                            <option value="">---wählen Sie eine DDC Sachgruppe---</option>
                            <tal:block tal:repeat="ddc DDCList">
                                <option tal:attributes="value ddc/code;
                                                        selected python: ddc['code'] == DDC"
                                        tal:content="string: ${ddc/code} - ${ddc/description}">123</option> 
                            </tal:block>
                        </select>
                    </td>
                </tr>
            </tbody>
            </table>

            <input class="context removefield"
                   tabindex=""
                   type="submit"
                   name="form.button.delDDC"
                   value="remove selected"
                   i18n:attributes="value remove-selected"
                   tal:attributes="tabindex tabindex/next;
                                   disabled python:test(isLocked, 'disabled', None);" />
            <input class="context addfield"
                   tabindex=""
                   type="submit"
                   name="form.button.addDDC"
                   value="add field"
                   i18n:attributes="value add-field"
                   tal:attributes="tabindex tabindex/next;
                                   disabled python:test(isLocked, 'disabled', None);" />

        </div>   
        
        <!--  TITEL -->
        <div metal:define-macro="title"
             class="field"
             tal:define="error errors/title|nothing;
                         meta_id string:title;
                         languages here/portal_properties/metadata_properties/available_languages|nothing;
                         title_value request/title_value|nothing;
                         title_lang request/title_lang|nothing;
                         form_titles python:test(upload, [{'value':title_value,'lang':title_lang}], qdc['title']);
                         titles request/title|form_titles"
             tal:attributes="class python:test(error, 'field error', 'field');
                             id meta_id"
             i18n:domain="qdc">

            <label>
                <span i18n:domain="qdc" i18n:translate="label_title">title</span>
                <a class="permalink" 
                   href="#"
                   tal:attributes="href string:${template_id}#${meta_id}"
                   i18n:attributes="title title_permalink"
                   title="Permalink für diese Überschrift">¶</a>
            </label>
            
            <span class="fieldRequired" title="Required"
                   i18n:attributes="title"
                   i18n:domain="plone"
                   i18n:translate="label_required">(Required)</span>
            
            <div tal:content="error">Validation error output</div>
            
            <table class="listing nosort metadata">
            <thead>
                <tr>
                    <th></th>
                    <th i18n:translate="label_title">Titel</th>
                    <th i18n:translate="label_language">Sprache</th>
                </tr>
            </thead>
            <tbody>
                <tr tal:repeat="title titles" tal:attributes="class python:test(path('repeat/title/even'), 'even', 'odd');
                                id string:${meta_id}_${repeat/title/index}">
                    <td>
                        <input type="checkbox" 
                               class="noborder counter"
                               name="title_index:int:list" 
                               value=""
                               tal:attributes="value repeat/title/index"/>
                    </td>
                    <td>
                        <input type="text"
                               class="title"
                               name="title.value:records" 
                               tal:attributes="value python: title['value']" />
                    </td>
                    <td>
                        <select name="title.lang:records">
                            <option i18n:translate="" value="">---Sprache---</option>
                            <tal:block tal:repeat="language available_languages">
                                <option tal:attributes="value language;
                                                        selected python: language == title['lang']"
                                        tal:content="python:all_languages[language]">ger</option> 
                            </tal:block>
                        </select>
                    </td>
                </tr>
            </tbody>
            </table>
            
            <input class="context removefield"
                   tabindex=""
                   type="submit"
                   name="form.button.delTitle"
                   value="remove selected"
                   i18n:attributes="value remove-selected"
                   tal:attributes="tabindex tabindex/next;
                                   disabled python:test(isLocked, 'disabled', None);" />
            
            <input class="context addfield"
                   tabindex=""
                   type="submit"
                   name="form.button.addTitle"
                   value="add field"
                   i18n:attributes="value add-field"
                   tal:attributes="tabindex tabindex/next;
                                   disabled python:test(isLocked, 'disabled', None);" />
        </div>

        <!-- ALTERNATIVER TITEL -->
        <div metal:define-macro="alternative"
             class="field"
             tal:define="error errors/alternative|nothing;
                         meta_id string:alternative;
                         alternatives request/alternative|python:qdc['alternative']"
             tal:attributes="class python:test(error, 'field error', 'field');
                             id meta_id"
             i18n:domain="qdc">

            <label>
                <span i18n:domain="qdc" i18n:translate="label_alternative">alternative</span>
                <a class="permalink" 
                   href="#"
                   tal:attributes="href string:${template_id}#${meta_id}"
                   i18n:attributes="title title_permalink"
                   title="Permalink für diese Überschrift">¶</a>
            </label>
            
            <div tal:content="error">Validation error output</div>
            
            <table class="listing nosort metadata">
            <thead>
                <tr>
                    <th></th>
                    <th i18n:translate="label_title">Titel</th>
                    <th i18n:translate="label_language">Sprache</th>
                </tr>
            </thead>
            <tbody>
                <tr tal:repeat="alternative alternatives"
                    tal:attributes="class python:test(path('repeat/alternative/even'), 'even', 'odd');
                                    id string:${meta_id}_${repeat/alternative/index}">
                    <td>
                        <input type="checkbox" 
                               class="noborder counter"
                               name="alternative_index:int:list" 
                               value=""
                               tal:attributes="value repeat/alternative/index"/>
                    </td>
                    <td>
                        <input type="text" class="alternative" name="alternative.value:records"  tal:attributes="value python: alternative['value']" />
                    </td>
                    <td>
                        <select name="alternative.lang:records">
                            <option i18n:translate="" value="">---Sprache---</option>
                            <tal:block tal:repeat="language available_languages">
                                <option tal:attributes="value language;
                                                        selected python: language == alternative['lang']"
                                        tal:content="python:all_languages[language]">ger</option> 
                            </tal:block>
                        </select>
                    </td>
                </tr>
            </tbody>
            </table>
            
            <input class="context removefield"
                   tabindex=""
                   type="submit"
                   name="form.button.delAlternative"
                   value="remove selected"
                   i18n:attributes="value remove-selected"
                   tal:attributes="tabindex tabindex/next;
                                   disabled python:test(isLocked, 'disabled', None);" />
            <input class="context addfield"
                   tabindex=""
                   type="submit"
                   name="form.button.addAlternative"
                   value="add field"
                   i18n:attributes="value add-field"
                   tal:attributes="tabindex tabindex/next;
                                   disabled python:test(isLocked, 'disabled', None);" />

        </div>

        <!--Abstract -->
        <div metal:define-macro="abstract"
             class="field"
             tal:define="error errors/abstract|nothing;
                         meta_id string:abstract;
                         abstracts request/DCTermsAbstract|python:qdc['DCTermsAbstract']"
             tal:attributes="class python:test(error, 'field error', 'field');
                             id meta_id"
             i18n:domain="qdc">
            <label>
                <span i18n:domain="qdc" i18n:translate="label_abstract">Abstract</span>
                <a class="permalink" 
                   href="#"
                   tal:attributes="href string:${template_id}#${meta_id}"
                   i18n:attributes="title title_permalink"
                   title="Permalink für diese Überschrift">¶</a>
            </label>

            <div tal:content="error">Validation error output</div>
            <div class="formHelp" i18n:translate="help_abstract">
                Es ist nur reiner Text erlaubt, keine HTML tags verwenden.
            </div>
            <table class="listing nosort metadata">
            <thead>
                <tr>
                    <th></th>
                    <th i18n:translate="label_abstract">Zusammenfassung</th>
                    <th i18n:translate="label_language">Sprache</th>
                </tr>
            </thead>
            <tbody>
                <tr tal:repeat="abstract abstracts"
                    tal:attributes="class python:test(path('repeat/abstract/even'), 'even', 'odd');
                                    id string:${meta_id}_${repeat/abstract/index}">
                    <td>
                        <input type="checkbox" 
                               class="noborder counter"
                               name="abstract_index:int:list" 
                               value=""
                               tal:attributes="value repeat/abstract/index"/>
                    </td>
                    <td>
                        <textarea rows="5" cols="200" class="abstract" name="DCTermsAbstract.value:records"  tal:content="python: abstract['value']" ></textarea>
                    </td>
                    <td>
                        <select name="DCTermsAbstract.lang:records">
                            <option i18n:translate="" value="">---Sprache---</option>
                            <tal:block tal:repeat="language available_languages">
                                <option tal:attributes="value language;
                                                        selected python: language == abstract['lang']"
                                        tal:content="python:all_languages[language]">ger</option> 
                            </tal:block>
                        </select>
                    </td>
                </tr>
            </tbody>
            </table>
            
            <input class="context removefield"
                   tabindex=""
                   type="submit"
                   name="form.button.delAbstract"
                   value="remove selected"
                   i18n:attributes="value remove-selected"
                   tal:attributes="tabindex tabindex/next;
                                   disabled python:test(isLocked, 'disabled', None);" />
            
            <input class="context addfield"
                   tabindex=""
                   type="submit"
                   name="form.button.addAbstract"
                   value="add field"
                   i18n:attributes="value add-field"
                   tal:attributes="tabindex tabindex/next;
                                   disabled python:test(isLocked, 'disabled', None);" />
        </div>
        
        <!-- AUTOREN -->             
        <div metal:define-macro="creatorPerson"
             class="field"
             tal:define="error errors/creatorPerson|nothing;
                         meta_id string:creatorPerson;
                         author_identifier here/bibtool/get_author_identifier|nothing;
                         default python:[];
                         creatorPerson request/creatorPerson|python:qdc['creatorPerson']"
             tal:attributes="class python:test(error, 'field error', 'field');
                             id meta_id"
             i18n:domain="qdc">

            <label>
                <span i18n:translate="label_creatorPerson">creatorPerson</span>
                <a class="permalink" 
                   href="#"
                   tal:attributes="href string:${template_id}#${meta_id}"
                   i18n:attributes="title title_permalink"
                   title="Permalink für diese Überschrift">¶</a>
            </label>
         
            <span class="fieldRequired" title="Required"
                   i18n:attributes="title"
                   i18n:domain="plone"
                   i18n:translate="label_required">(Required)</span>
            <div tal:content="error">Validation error output</div>
            
            <table class="listing nosort metadata">
            <thead>
                <tr>
                    <th></th>
                    <th i18n:translate="academicTitle">akad. Titel</th>
                    <th i18n:translate="lastName">Nachname</th>
                    <th i18n:translate="firstName">Vorname</th>
                    <th i18n:translate="emailAddress">E-Mail</th>
                    <th i18n:translate="organization">Organisation</th>
                    <th i18n:translate="postalAddress">Anschrift</th>
                    <th i18n:translate="PNDIdentNumber">PNDIdentNummer</th>
                    <tal:block tal:repeat="identifier python:author_identifier.keys()">
                        <th tal:content="python: author_identifier[identifier]"></th>
                    </tal:block>
                </tr>
            </thead>
            <tbody>
                <tr tal:repeat="person creatorPerson" 
                    tal:attributes="class python:test(path('repeat/person/even'), 'even', 'odd');
                                    id string:${meta_id}_${repeat/person/index}">
                    <td>
                        <input type="checkbox" 
                               class="noborder counter"
                               name="author_index:int:list" 
                               value=""
                               tal:attributes="value repeat/person/index"/>
                        <input type="hidden" class="dippIdentNumber" value="" name="creatorPerson.dippIdentNumber:records" tal:attributes="value person/dippIdentNumber" />    
                    </td>
                    <td>
                        <input type="text" class="academicTitle" value="" name="creatorPerson.academicTitle:records" tal:attributes="value person/academicTitle">    
                    </td>
                    <td>
                        <input type="text" class="lastName" value="" name="creatorPerson.lastName:records" tal:attributes="value person/lastName">    
                    </td>
                    <td>
                        <input type="text" class="firstName" value="" name="creatorPerson.firstName:records" tal:attributes="value person/firstName">    
                    </td>
                    <td>
                        <input type="email" class="emailAddress" value="" name="creatorPerson.emailAddress:records" tal:attributes="value person/emailAddress">    
                    </td>
                    <td>
                        <input type="text" class="organization" value="" name="creatorPerson.organization:records" tal:attributes="value person/organization">    
                    </td>
                    <td>
                        <input type="text" class="postalAddress" value="" name="creatorPerson.postalAddress:records" tal:attributes="value person/postalAddress">    
                    </td>
                    <td>
                        <input type="text" class="personId PNDIdentNumber" value="" name="creatorPerson.PNDIdentNumber:records" tal:attributes="value person/PNDIdentNumber">
                    </td>
                    <tal:block tal:repeat="identifier python:author_identifier.keys()" >
                        <td>
                            <input type="text" class="" value="" name="" 
                                   tal:attributes="class string:personId $identifier;
                                                   name string:creatorPerson.ident_$identifier:records;
                                                   value python:person['ident_%s' % identifier]">    
                        <div class="person-id-result"></div>
                        </td>
                    </tal:block>
                </tr>
            </tbody>
            </table>
            
            <input class="context removefield"
                   tabindex=""
                   type="submit"
                   name="form.button.delAuthor"
                   value="delete selected"
                   i18n:attributes="value remove-selected"
                   tal:attributes="tabindex tabindex/next;
                                   disabled python:test(isLocked, 'disabled', None);" />
            
            <input class="context addfield"
                   tabindex=""
                   type="submit"
                   name="form.button.addAuthor"
                   value="add field"
                   i18n:attributes="value add-field"
                   tal:attributes="tabindex tabindex/next;
                                   disabled python:test(isLocked, 'disabled', None);" />
        </div>

        
        <!-- korporative Autoren -->
        <div metal:define-macro="creatorCorporated"
             class="field"
             tal:define="error errors/creatorCorporated|nothing;
                         meta_id string:creatorCorporated;
                         creatorCorporated request/creatorCorporated|python:qdc['creatorCorporated']"
             tal:attributes="class python:test(error, 'field error', 'field');
                             id meta_id"
             i18n:domain="qdc">

             <label>
                <span i18n:translate="label_creatorCorporate">korporative Autoren</span>
                <a class="permalink" 
                   href="#"
                   tal:attributes="href string:${template_id}#${meta_id}"
                   i18n:attributes="title title_permalink"
                   title="Permalink für diese Überschrift">¶</a>
             </label>

             <div tal:content="error">Validation error output</div>
            
             <table class="listing nosort metadata">
             <thead>
                <tr>
                    <th></th>
                    <th i18n:translate="">Name</th>
                    <th i18n:translate="emailAddress">E-Mail</th>
                    <th i18n:translate="organization">Organisation</th>
                    <th i18n:translate="postalAddress">Anschrift</th>
                    <th i18n:translate="GKDIdentNumber">GKDIdentNummer</th>
                </tr>
            </thead>
            <tbody>
                <tr tal:repeat="creator creatorCorporated"
                    tal:attributes="class python:test(path('repeat/creator/even'), 'even', 'odd');
                    id string:${meta_id}_${repeat/creator/index}">
                    <td>
                        <input type="checkbox" 
                               class="noborder counter"
                               name="corp_index:int:list" 
                               value=""
                               tal:attributes="value repeat/creator/index"/>
                    </td>
                    <td>
                        <input type="text" 
                               class="institutionelAuthor" 
                               value="" 
                               name="creatorCorporated.institutionelAuthor:records" 
                               tal:attributes="value creator/institutionelAuthor">    
                    </td>
                    <td>
                        <input type="email"
                               class="emailAddress"
                               value="" 
                               name="creatorCorporated.emailAddress:records" 
                               tal:attributes="value creator/emailAddress">    
                    </td>
                    <td>
                        <input type="text"
                               class="organization"
                               value="" 
                               name="creatorCorporated.organization:records"
                               tal:attributes="value creator/organization">    
                    </td>
                    <td>
                        <input type="text" 
                               class="postalAddress"
                               value="" 
                               name="creatorCorporated.postalAddress:records"
                               tal:attributes="value creator/postalAddress">    
                    </td>
                    <td>
                        <input type="text" 
                               class="GKDIdentNumber personId"
                               value=""
                               name="creatorCorporated.GKDIdentNumber:records"
                               tal:attributes="value creator/GKDIdentNumber">    
                    </td>
                </tr>
            </tbody>
            </table>
            
            <input class="context removefield"
                   tabindex=""
                   type="submit"
                   name="form.button.delCorp"
                   value="delete selected"
                   i18n:attributes="value remove-selected"
                   tal:attributes="tabindex tabindex/next;
                                   disabled python:test(isLocked, 'disabled', None);" />
            
            <input class="context addfield"
               tabindex=""
               type="submit"
               name="form.button.addCorp"
               value="add field"
               i18n:attributes="value add-field"
               tal:attributes="tabindex tabindex/next;
                               disabled python:test(isLocked, 'disabled', None);" />
        </div>

        <!-- Mitwirkende -->
        <div metal:define-macro="contributor"
             class="field"
             tal:define="error errors/contributor|nothing;
                         meta_id string:contributor;
                         author_identifier here/bibtool/get_author_identifier|nothing;
                         contributor request/contributor|python:qdc['contributor']"
             tal:attributes="class python:test(error, 'field error', 'field');
                             id meta_id"
             i18n:domain="qdc">

             <label>
                <span i18n:translate="label_contributor">Mitwirkende</span>
                <a class="permalink" 
                   href="#"
                   tal:attributes="href string:${template_id}#${meta_id}"
                   i18n:attributes="title title_permalink"
                   title="Permalink für diese Überschrift">¶</a>
             </label>
        
             <div tal:content="error">Validation error output</div>
            <table class="listing nosort metadata">
            <thead>
                <tr>
                    <th></th>
                    <th i18n:translate="academicTitle">akad. Titel</th>
                    <th i18n:translate="lastName">Nachname</th>
                    <th i18n:translate="firstName">Vorname</th>
                    <th i18n:translate="emailAddress">E-Mail</th>
                    <th i18n:translate="role">Rolle</th>
                    <th i18n:translate="organization">Organisation</th>
                    <th i18n:translate="postalAddress">Anschrift</th>
                    <th i18n:translate="PNDIdentNumber">PNDIdentNummer</th>
                    <tal:block tal:repeat="identifier python:author_identifier.keys()">
                        <th tal:content="python: author_identifier[identifier]"></th>
                    </tal:block>
                </tr>
            </thead>
            <tbody>
                <tr tal:repeat="person contributor"
                    tal:attributes="class python:test(path('repeat/person/even'), 'even', 'odd');
                                    id string:${meta_id}_${repeat/person/index}">
                    <td>
                        <input type="checkbox" 
                               class="noborder counter"
                               name="contributor_index:int:list" 
                               value=""
                               tal:attributes="value repeat/person/index"/>
                        <input type="hidden" class="dippIdentNumber" value="" name="contributor.dippIdentNumber:records" tal:attributes="value person/dippIdentNumber" />    
                    </td>
                    <td>
                        <input type="text"
                               class="academicTitle"
                               value="" 
                               name="contributor.academicTitle:records" 
                               tal:attributes="value person/academicTitle">    
                    </td>
                    <td>
                        <input type="text"
                               class="lastName"
                               value="" 
                               name="contributor.lastName:records"
                               tal:attributes="value person/lastName">    
                    </td>
                    <td>
                        <input type="text" 
                               class="firstName" 
                               value="" 
                               name="contributor.firstName:records"
                               tal:attributes="value person/firstName">    
                    </td>
                    <td>
                        <input type="email"
                               class="emailAddress"
                               value="" 
                               name="contributor.emailAddress:records"
                               tal:attributes="value person/emailAddress">    
                    </td>
                    <td>
                        <input type="text"
                               class="role"
                               value="" 
                               name="contributor.role:records" 
                               tal:attributes="value person/role">    
                    </td>
                    <td>
                        <input type="text"
                               class="organization" 
                               value=""
                               name="contributor.organization:records"
                               tal:attributes="value person/organization">    
                    </td>
                    <td>
                        <input type="text" 
                               class="postalAddress" 
                               value="" 
                               name="contributor.postalAddress:records" 
                               tal:attributes="value person/postalAddress">    
                    </td>
                    <td>
                        <input type="text"
                               class="personId PNDIdentNumber"
                               value="" 
                               name="contributor.PNDIdentNumber:records"
                               tal:attributes="value person/PNDIdentNumber">    
                    </td>
                    <tal:block tal:repeat="identifier python:author_identifier.keys()">
                        <td>
                            <input type="text" class="" value="" name="" 
                                   tal:attributes="class string:personId $identifier;
                                                   name string:contributor.ident_$identifier:records;
                                                   value python:person['ident_%s' % identifier]">    
                        </td>
                    </tal:block>
                </tr>
            </tbody>
            </table>

            <input class="context removefield"
                   tabindex=""
                   type="submit"
                   name="form.button.delContributor"
                   value="delete selected"
                   i18n:attributes="value remove-selected"
                   tal:attributes="tabindex tabindex/next;
                                   disabled python:test(isLocked, 'disabled', None);" />
            
            <input class="context addfield"
                   tabindex=""
                   type="submit"
                   name="form.button.addContributor"
                   value="add field"
                   i18n:attributes="value add-field"
                   tal:attributes="tabindex tabindex/next;
                                   disabled python:test(isLocked, 'disabled', None);" />
             
        </div>

        <!-- freie Schlagwörter -->
        <div metal:define-macro="subject"
             class="field"
             tal:define="error errors/subject|nothing;
                         subject request/subject|qdc/subject|nothing;
                         new_subjects request/new_subjects|nothing"
             tal:attributes="class python:test(error, 'field error', 'field')"
             i18n:domain="qdc">
            <label for="subjectClassified" i18n:translate="label_subject">Freie Schlagworte</label>
            <div tal:content="error">Validation error output</div>
            
            <table class="nosort metadata listing">
            
                <colgroup>
                  <col width="50%">
                  <col width="50%">
                </colgroup>
                            
                <thead>
                    <tr>
                        <th i18n:translate="help_existing_keywords">
                            Existing keywords
                        </th>
                        <th i18n:translate="help_new_subject">
                            New keywords, one per row.
                        </th>
                    </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                        <ol class="keywords"
                            tal:define="allowedKeywords python:here.portal_catalog.uniqueValuesFor('Subject')">
                            <tal:block tal:repeat="keyword allowedKeywords">
                                <li tal:condition="python: keyword in subject">
                                    <input type="checkbox" 
                                           class="noborder"
                                           name="subject:list"
                                           value=""
                                           id=""
                                           tal:attributes="value keyword;
                                                           id string: keyword_$keyword;
                                                           checked python: keyword in subject"/>
                                    <label tal:content="keyword"
                                           for=""
                                           tal:attributes="selected python: keyword in subject;
                                                           for string: keyword_$keyword;
                                                           value keyword">sdaf</label>
                                </li>
                            </tal:block>
                            <tal:block tal:repeat="keyword allowedKeywords">
                                <li tal:condition="python: keyword not in subject">
                                    <input type="checkbox" 
                                           class="noborder"
                                           name="subject:list"
                                           value=""
                                           id=""
                                           tal:attributes="value keyword;
                                                           id string: keyword_$keyword;
                                                           checked python: keyword in subject"/>
                                    <label tal:content="keyword"
                                           for=""
                                           tal:attributes="selected python: keyword in subject;
                                                           for string: keyword_$keyword;
                                                           value keyword">sdaf</label>
                                </li>
                            </tal:block>
                        </ol>
                    </td>
                    <td>
            <textarea name="new_subjects:lines" rows="5" cols="50"><tal:block tal:repeat="keyword new_subjects"><tal:block tal:replace="keyword">Keyword</tal:block>
</tal:block></textarea>
                    </td>
                </tr>
            </tbody>
            </table>
        </div>

        <!-- normierte Schlagwörter -->
        <div metal:define-macro="subjectClassified"
             class="field"
             tal:define="error errors/subjectClassified|nothing;
                         meta_id string:subjectClassified;
                         default python: {'classificationIdent': '', 'classificationSystem': '', 'subjectClassified': ''};
                         subjectClassified request/subjectClassified|qdc/subjectClassified|default;
                         classifications here/classifications"
             tal:attributes="class python:test(error, 'field error', 'field');
                             id meta_id"
             i18n:domain="qdc">

            <label for="subjectClassified">
                <span i18n:translate="label_subjectClassified">subjectClassified</span>
                <a class="permalink" 
                   href="#"
                   tal:attributes="href string:${template_id}#${meta_id}"
                   i18n:attributes="title title_permalink"
                   title="Permalink für diese Überschrift">¶</a>
            </label>

            <div tal:content="error">Validation error output</div>
            
            <div class="formHelp" >
            
            <p i18n:translate="help_subjectClassified">Add classified keywords according to the following schemes:
                <span i18n:name="classifications">
                    <tal:block tal:repeat="cls python:classifications.keys()">
                        <a tal:attributes="href python:classifications[cls]['url']" tal:content="cls">abc</a>
                    </tal:block>
                </span>
            </p>
            
            </div>
            
            <table class="listing nosort metadata">
            
                <thead>
                    <tr>
                        <th></th>
                        <th i18n:translate="keyword">Schlagwort</th>
                        <th i18n:translate="identNo">IdentNr.</th>
                        <th i18n:translate="source">Quelle</th>
                    </tr>
                </thead>
                
                <tbody>
                <tal:items tal:repeat="keyword subjectClassified">
                <tr tal:define="oddrow repeat/keyword/odd;"
                    tal:attributes="class python:test(oddrow, 'even', 'odd');
                                    id string:${meta_id}_${repeat/keyword/index}">
                        <td>
                            <input type="checkbox" 
                                   class="noborder counter"
                                   name="keyword_index:int:list" 
                                   value=""
                                   tal:attributes="value repeat/keyword/index"/>
                        </td>
                        <td>
                            <input class="subject"
                                   type="text"
                                   value="" 
                                   name="subjectClassified.subjectClassified:records"
                                   tal:attributes="value keyword/subjectClassified"/>
                        </td>
                        <td>
                            <input class="identNr" 
                                   type="text" 
                                   value="" 
                                   name="subjectClassified.classificationIdent:records"
                                   tal:attributes="value keyword/classificationIdent"/>
                        </td>
                        <td>
                            <select name="subjectClassified.classificationSystem:records">
                                <option value="">--- wählen Sie eine Normdatei ---</option>
                                <tal:block tal:repeat="cls python:classifications.keys()">
                                    <option tal:attributes="value cls;
                                                            selected python: cls == keyword['classificationSystem']"
                                            tal:content="python: '%s - (%s)' % (cls, classifications[cls]['title'])">abc</option>
                                </tal:block>
                            </select>
                        </td>
                </tr>
                </tal:items>
                </tbody>
            </table>
            
            <input class="context removefield"
                   tabindex=""
                   type="submit"
                   name="form.button.delKeyword"
                   value="remove selected"
                   i18n:attributes="value remove-selected"
                   tal:attributes="tabindex tabindex/next;
                                   disabled python:test(isLocked, 'disabled', None);" />
            
            <input class="context addfield"
                   tabindex=""
                   type="submit"
                   name="form.button.addKeyword"
                   value="add field"
                   i18n:attributes="value add-field"
                   tal:attributes="tabindex tabindex/next;
                                   disabled python:test(isLocked, 'disabled', None);" />
       </div>

           
        <!-- pubType -->
        <div metal:define-macro="pubType"
             class="field"
             tal:define="error errors/pubType|nothing;
                         pubTypes python:here.fedora.getPubtypes();
                         pubType request/pubType|python:qdc['pubType']"
             tal:attributes="class python:test(error, 'field error', 'field')"
             i18n:domain="qdc">

            <label for="pubType" i18n:translate="label_pubType">pubType</label>
            
            <span class="fieldRequired" title="Required"
                   i18n:attributes="title"
                   i18n:domain="plone"
                   i18n:translate="label_required">(Required)</span>

            <div tal:content="error">Validation error output</div>
            
            <div class="formHelp" i18n:translate="help_pubType">
                Geben Sie Art der Publikation an.
            </div>

            <select name="pubType:list">
                <tal:block tal:repeat="aPubType pubTypes">
                    <option tal:attributes="value aPubType;
                                            selected python:aPubType in pubType"
                            tal:content="python:pubTypes[aPubType]">
                    article</option>
                </tal:block>
            </select>

        </div>

        <!-- docType -->
        <div metal:define-macro="docType"
             class="field"
             tal:define="error errors/docType|nothing;
                         docTypes python:here.fedora.getDoctypes();
                         docType request/docType|python:qdc['docType']"
             tal:attributes="class python:test(error, 'field error', 'field')"
             i18n:domain="qdc">

            <label for="docType" i18n:translate="label_docType">docType</label>
            
            <span class="fieldRequired" title="Required"
                   i18n:attributes="title"
                   i18n:domain="plone"
                   i18n:translate="label_required">(Required)</span>
            
            <div tal:content="error">Validation error output</div>
            
            <div class="formHelp" i18n:translate="help_docType">
                Geben Sie den Dokumententyp an.
            </div>
            
            <select name="docType:list">
                <tal:block tal:repeat="aDocType docTypes">
                    <option tal:attributes="value aDocType;
                                            selected python:aDocType in docType"
                            tal:content="python:docTypes[aDocType]">
                    text</option>
                </tal:block>
            </select>

        </div>

        <!-- Daten -->
        <div metal:define-macro="dates"
             class="field"
             tal:define="error errors/dates|nothing;
                         accepted python:qdc.get('dateAccepted',None); 
                         copyrighted python:qdc.get('dateCopyrighted',None);
                         submitted python:qdc.get('dateSubmitted',None)"
            i18n:domain="qdc"
            tal:attributes="class python:test(error, 'field error', 'field')" >
            
            <tal:comment tal:replace="nothing">
            <input class="date" maxlength="10" type="hidden" name="dateSubmitted" value="" tal:attributes="value request/dateSubmitted|submitted|nothing" />
            <input class="date" maxlength="10" type="hidden" name="dateAccepted" value="" tal:attributes="value request/dateAccepted|accepted|nothing" />
            <input class="date" maxlength="10" type="hidden" name="dateCopyrighted" value="" tal:attributes="value request/dateCopyrighted|copyrighted|nothing"/>
            
            </tal:comment>
                <label i18n:translate="label_publishingdates">Dates of the publishing history</label>
                <div tal:content="error">Validation error output</div>
                <div class="formHelp" i18n:translate="help_dates">
                    Format: JJJJ-MM-TT
                </div>
                <table class="listing">
                    <tr>
                        <th i18n:translate="label_submitted">submitted</th>
                        <th i18n:translate="label_accepted">accepted</th>
                        <th i18n:translate="label_copyrighted">copyrighted</th>
                    </tr>
                    <tr>
                        <td><input class="date" maxlength="10" type="date" name="dateSubmitted" value="" tal:attributes="value request/dateSubmitted|submitted|nothing" /></td>
                        <td><input class="date" maxlength="10" type="date" name="dateAccepted" value="" tal:attributes="value request/dateAccepted|accepted|nothing" /></td>
                        <td><input class="date" maxlength="10" type="date" name="dateCopyrighted" value="" tal:attributes="value request/dateCopyrighted|copyrighted|nothing"/></td>
                    </tr>
                </table>
            
        </div>


            <!-- BibliographicCitation-->
        <div metal:define-macro="bibliographicCitation"
            class="field"
            tal:define="error errors/bibliographicCitation|nothing;
                        defaultJournalTitle here/portal_properties/metadata_properties/journalname|nothing;    
                        bibliographicCitation  request/bibliographicCitation|python:qdc['bibliographicCitation'];
                        startpage request/startpage|here/startpage|nothing;
                        endpage request/endpage|here/endpage|nothing"
            tal:attributes="class python:test(error, 'field error', 'field')"
            i18n:domain="qdc">
            <label i18n:translate="label_bibliographicCitation" id="bc">Bibliographic Citation</label>
            <span class="fieldRequired" title="Required"
                   i18n:attributes="title"
                   i18n:domain="plone"
                   i18n:translate="label_required">(Required)</span>
            <div tal:content="error">Validation error output</div>
            <div class="formHelp" i18n:translate="help_bibliographicCitation">
            </div>
            <table class="listing">
                <tr>
                    <th i18n:translate="label_journalTitle">journalTitle</th>
                    <th i18n:translate="label_journalVolume">journalVolume</th>
                    <th i18n:translate="label_journalIssueNumber">journalIssueNumber</th>
                    <th i18n:translate="label_startpage">startpage</th>
                    <th i18n:translate="label_endpage">endpage</th>
                    <th i18n:translate="label_journalIssueDate">journalIssueDate</th>
                </tr>
                <tr>
                    <td>
                        <input class="journalTitle"
                               type="text"
                               name="bibliographicCitation.journalTitle:records"
                               tal:define="journalTitle python:bibliographicCitation[0]['journalTitle']"
                               value =""
                               tal:attributes="value python:test(journalTitle.strip()!='', journalTitle, defaultJournalTitle)" />
                    </td>
                    <td>
                        <input class="journalVolume"
                               type="text"
                               name="bibliographicCitation.journalVolume:records"
                               value =""
                               tal:attributes="value python:bibliographicCitation[0]['journalVolume']" />
                    </td>
                    <td>
                        <input class="journalIssueNumber"
                               type="text"
                               name="bibliographicCitation.journalIssueNumber:records"  
                               value =""
                               tal:attributes="value python:bibliographicCitation[0]['journalIssueNumber']" />
                    </td>
                    <td>
                        <input  class="pagenumber"
                                type="text"
                                name="startpage"
                                value=""
                                tal:attributes="value startpage;
                                                disabled python: upload" />
                    </td>
                    <td>
                        <input class="pagenumber"
                               type="text" 
                               name="endpage"
                               value=""
                               tal:attributes="value endpage;
                                               disabled python: upload" />
                    </td>
                    <td>
                        <input class="journalIssueDate" 
                               type="date" 
                               maxlength="10"
                               name="bibliographicCitation.journalIssueDate:records"   
                               value =""
                               tal:attributes="value python:bibliographicCitation[0]['journalIssueDate']" />
                    </td>
                </tr>
            </table>
            
        </div>

        <!-- Section-->
        <div metal:define-macro="section"  
            class="field" 
            i18n:domain="qdc" 
            tal:define="error            errors/journal_section|nothing;
                        avtm             python:here.portal_vocabularies;
                        journalsections  python:avtm.getVocabularyByName('journal-sections');
                        default_section  string:no-section;
                        section_dict     python:journalsections.getVocabularyDict(journalsections);
                        journal_section  request/journal_section|here/journal_section|default_section"
            tal:attributes="class python:test(error, 'field error', 'field')">
            <label i18n:translate="label_journalsection" id="journal_section">Section</label>
            <div tal:content="error">Validation error output</div>
            <div class="formHelp" i18n:translate="help_journalsection">
                A journal section
            </div>
            
            <select name="journal_section">
                <tal:block tal:repeat="section python: section_dict.keys()">
                    <option tal:attributes="value section;
                                            selected python: section == journal_section"
                           tal:content="python:section_dict[section]">
                            Research and development
                    </option>
                </tal:block>
            </select>
            
        </div>
        
        <!-- DOI-->
        <div metal:define-macro="doi"
            tal:condition="here/portal_doiregistry/endpoint"
            class="field" 
            i18n:domain="qdc"
            tal:define="error errors/identifierDOI|nothing;
                        meta_id string:doi;   
                        dc_tool here/portal_doiregistry;
                        identifierDOI  python:qdc['identifierDOI'];
                        datacite_status python:200;
                        doi_editable python:True"
            tal:attributes="class python:test(error, 'field error', 'field');
                            id meta_id">
                        <!--
                        datacite_status python:dc_tool.get_url(identifierDOI)[0];
                        doi_editable python:test(datacite_status=='404' or not identifierDOI,True,False)"
                        -->
            <label>
                <span i18n:translate="label_identifierDOI">DOI</span>
                <a class="permalink" 
                   href="#"
                   tal:attributes="href string:${template_id}#${meta_id}"
                   i18n:attributes="title title_permalink"
                   title="Permalink für diese Überschrift">¶</a>
            </label>
            
            <span tal:condition="not: doi_editable"
                  class="fieldLocked" 
                  title="Locked"
                  i18n:attributes="title"
                  i18n:domain="qdc"
                  i18n:translate="label_locked">(Locked)</span>
            
            <div tal:content="error">Validation error output</div>
            
            <div class="formHelp" i18n:translate="help_identifierDOI">
                DOI steht für Digital Object Identifier und dient ähnlich der URN als persistenter Identifier einer Resource.
                DOIs bestehen aus einem internen Suffix und einem von einem Provider wie CrossRef oder der TIB vergebenen Prefix
                das üblicherweise die Form "10.xxxx" hat. Sobald die Metadaten und damit die DOI registriert sind, läßt sich der
                Wert nicht mehr ändern.
            </div>
            
            <input type="text" 
                   name="identifierDOI"   
                   value =""
                   tal:attributes="value request/identifierDOI|identifierDOI|nothing;
                                   readonly python:test(doi_editable,'','readonly')" />
            
        </div>


        <!--rights-->
        <div metal:define-macro="rights"
             class="field"
             tal:define="error errors/rights|nothing;
                         rights  request/rights|python:qdc['rights']"
             tal:attributes="class python:test(error, 'field error', 'field')"
             i18n:domain="qdc">
             <label i18n:translate="label_rights" id="rights">rights</label>

            <span class="fieldRequired" title="Required"
                   i18n:attributes="title"
                   i18n:domain="plone"
                   i18n:translate="label_required">(Required)</span>
            <div tal:content="error">Validation error output</div>
            <div class="formHelp" i18n:translate="help_rights">
                Sollten Sie nicht der Autor sein, stellen Sie
                sicher, dass sie das Einverständnis des Autors zur Wahl dieser Lizenz
                vorliegen haben.
            </div>
            <div>
                <input type="radio" class="noborder" name="rights:list" value="DPPL" tal:attributes="checked python:'DPPL' in path('request/rights | rights | python:[]')"/>
                <span i18n:translate="dppl">Digital Peer Publishing Lizenz</span> <a href="http://www.dipp.nrw.de/">de</a><br />

                <input type="radio" class="noborder" name="rights:list" value="mDPPL" tal:attributes="checked python:'mDPPL' in path('request/rights | rights | python:[]')"/>
                <span i18n:translate="mdppl">modulare Digital Peer Publishing Lizenz</span> <a href="http://www.dipp.nrw.de/">de</a><br />
                
                <input type="radio" class="noborder" name="rights:list" value="fDPPL" tal:attributes="checked python:'fDPPL' in path('request/rights | rights | python:[]')"/>
                <span i18n:translate="fdppl">freie Digital Peer Publishing Lizenz</span> <a href="http://www.dipp.nrw.de/">de</a><br />
                
                <input type="radio" class="noborder" name="rights:list" value="cc-by" tal:attributes="checked python:'cc-by' in path('request/rights | rights | python:[]')"/>
                <span i18n:translate="cc-by">Creative Commons Attribution</span> <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a><br />
                
                <input type="radio" class="noborder" name="rights:list" value="cc-by-sa" tal:attributes="checked python:'cc-by-sa' in path('request/rights | rights | python:[]')"/>
                <span i18n:translate="cc-by-sa">Creative Commons Attribution-ShareAlike</span> <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a><br />
                
                <input type="radio" class="noborder" name="rights:list" value="cc-by-nc" tal:attributes="checked python:'cc-by-nc' in path('request/rights | rights | python:[]')"/>
                <span i18n:translate="cc-by-nc">Creative Commons Attribution-NonCommercial</span> <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a><br />
                
                <input type="radio" class="noborder" name="rights:list" value="cc-by-nd" tal:attributes="checked python:'cc-by-nd' in path('request/rights | rights | python:[]')"/>
                <span i18n:translate="cc-by-nd">Creative Commons Attribution-NoDerivates</span> <a href="https://creativecommons.org/licenses/by-nd/4.0/">CC-BY-ND 4.0</a><br />
                
                <input type="radio" class="noborder" name="rights:list" value="authorcontract" tal:attributes="checked python:'authorcontract' in path('request/rights | rights | python:[]')"/>
                <span i18n:translate="">No Licence is used. All rights are covered by an author contract</span><br />
            
            </div>

        <div metal:define-macro="fields" id="qdc-fields">




            
        


            </div>
        </div>
    </body>
</html>

<p tal:replace="structure here/manage_page_header" omit-tag="">Header</p>
<h2 tal:define="manage_tabs_message options/manage_tabs_message | nothing"
    tal:replace="structure here/manage_tabs">Tabs</h2>

<div tal:condition="not: here/label" class="system-msg">You must configure alabel first
</div>

<h3>URN Maintenance</h3>
<p>
    Only Object with the Content Model DiPP:Article are shown.
</p>
<form tal:condition="here/label"
      action="manage_maintenance_form"
      tal:define="fields python:('pid','cDate','mDate','title');
                  comparisions python:(('has','contains'),('eq','equals'),('lt','less'),('le','less or equal'),('gt','greater'),('ge','greater or equal'))">

    <input name="field:list"      type="hidden" value="label">
    <input name="comparison:list" type="hidden" value="has">
    <input name="value:list"      type="hidden" value="" tal:attributes="value here/label">
    
    <input name="field:list"      type="hidden" value="cModel">
    <input name="comparison:list" type="hidden" value="has">
    <input name="value:list"      type="hidden" value="DiPP:article">
    
    <tal:block tal:repeat="opt python:range(3)">
        <select name="field:list">
            <option value="0">Select a field</option>
            <tal:block tal:repeat="field fields">
                <option value="" tal:attributes="value field" tal:content="field"></option>
            </tal:block>
        </select>
        <select name="comparison:list">
            <tal:block tal:repeat="comparision comparisions">
                <option value="" tal:attributes="value python:comparision[0]" tal:content="python:comparision[1]"></option>
            </tal:block>
        </select>
        <input name="value:list" type="text" value="" /><br />
    </tal:block>
    
    <input type="submit" value="OK">
    <input type="reset" value="Cancel">
</form>

<div tal:define="field request/field|nothing;
                 comparison request/comparison|nothing;
                 value request/value|nothing" >

    <tal:block tal:condition="python: field!=None and comparison!=None and value!=None">
        <tal:block  tal:define="results python:here.manage_search(field=field,comparison=comparison,value=value);
                                PIDs python:here.getFedoraArticles()">
            <form action="manage_fixURLForm" tal:attributes="action python:here.absolute_url()+'/manage_fixURLForm'" method="POST">
                <table border="0" cellpadding="2" cellspacing="0" width="98%">
                    <tr class="list-header">
                        <th width="16">&nbsp;</th>
                        <th>PID</th>
                        <th>state</th>
                        <th>Plone</th>
                        <th>cDate</th>
                        <th>creator</th>
                        <th>Title</th>
                    </tr>
                    <tal:block tal:repeat="result results">
                        <tr tal:define="PID result/PID;
                                        cModel result/cModel"
                            tal:attributes="class python:test(path('repeat/result/even'), 'row-hilite', 'row-normal')">
                            <td width="16">
                                <input tal:condition="python: cModel == 'DiPP:article'" type="checkbox" name="PIDs:list" value="" tal:attributes="value result/PID">
                            </td>
                            <td tal:content="PID"></td>
                            <td tal:content="result/state"></td>
                            <td>
                                <span tal:condition="python: PID in PIDs">
                                yes
                                </span>
                                <span tal:condition="python: PID not in PIDs">
                                no
                                </span>
                            </td>
                            <td tal:content="result/cDate"></td>
                            <td tal:content="result/creator"></td>
                            <td tal:content="result/title"></td>
                        </tr>
                    </tal:block>
                </table>
                <input type="submit" value="fix URLs">
            </form>
        </tal:block>
    </tal:block>
</div>
<p tal:replace="structure here/manage_page_footer" omit-tag="">Footer</p>

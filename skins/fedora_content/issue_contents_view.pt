<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
<body>

<metal:main fill-slot="main">
    <tal:main-macro metal:define-macro="main"
             tal:define="path                 python:'/'.join(here.getPhysicalPath()); 
                         avtm                 python:here.portal_vocabularies;
                         journalsections      python:avtm.getVocabularyByName('journal-sections');
                         section_dict         python:journalsections.getVocabularyDict(journalsections);
                         articles             python: here.portal_catalog(path=path,portal_type='FedoraArticle');
                         issue_show_abstracts here/issue_show_abstracts|here/portal_properties/dipp_properties/issue_show_abstracts|nothing">
        
        <div metal:use-macro="here/document_actions/macros/document_actions">
            Document actions (print, sendto etc)
        </div>
        
        <h1 tal:content="here/title_or_id" class="documentFirstHeading">
          Title or id
        </h1>

        <div metal:use-macro="here/document_byline/macros/byline">
          Get the byline - contains details about author and modification date.
        </div>
    

        <div class="coverpicture"
             tal:define="has_cover here/TitleImage|nothing"
             tal:condition="has_cover">
             <img class="coverpicture" tal:replace="structure here/TitleImage" />
        </div>
        
        <div class="documentDescription"
           tal:content="here/Description"
           tal:condition="here/Description">
           Description
        </div>

        <p tal:define="Body here/Body|nothing"
           tal:condition="Body"
           tal:content="structure Body">
        </p>
        
        <p tal:define="CompleteIssue here/CompleteIssue|nothing"
           tal:condition="CompleteIssue/filename">
           Get the entire issue 
           <a tal:define="size python:here.getObjSize(CompleteIssue);
                          icon CompleteIssue/getBestIcon | nothing;
                          filename CompleteIssue/filename | nothing"
              href=""
              tal:attributes="href string:${here/absolute_url}/at_download/CompleteIssue">
              <img tal:condition="icon" src=""
                   tal:attributes="src string:${here/portal_url}/$icon"/>
              <span tal:replace="filename">full.pdf</span> (<span tal:replace="size">1GB</span>)</a>
        </p>
    
    
        <p class="discreet"
             tal:condition="not:articles">
             This Issue does not contain any articles.
        </p>
        
        <div tal:repeat="section python: section_dict.keys()">
            <tal:block tal:define="articles python: here.portal_catalog(path=path,portal_type='FedoraArticle',getJournal_section=section, sort_on='getObjPositionInParent')"
                       tal:condition="articles"
                       i18n:domain="dipp">
            <h2 tal:condition="python: section != 'no-section'" tal:content="python: section_dict[section]"></h2>
            <ol class="issue_content" >
                
                <tal:items tal:repeat="item articles">
                   <li tal:define="oddrow               repeat/item/odd;
                                   obj                  item/getObject;
                                   item_url             item/getURL|item/absolute_url;
                                   item_id              item/getId;
                                   item_section         item/getJournal_section;
                                   item_path            item/getPath|python:'/'.join(item.getPhysicalPath());
                                   item_title_or_id     item/pretty_title_or_id;
                                   item_section         item/getJournal_section|nothing;
                                   item_abstracts       python:obj.getAvailableAbstracts;
                                   item_contributors    python:obj.Contributors();
                                   authors              item_contributors"
                                   tal:attributes="class python:test(oddrow, 'even', 'odd')">
                        <strong>    
                            <a href="#"
                               tal:attributes="href item_url;" tal:content="item_title_or_id">
                             Article title</a>

                        </strong>
                        <div class="abstracts"
                            tal:define="lang_dict   python:here.fedora.getLanguages()"
                            tal:condition="python: issue_show_abstracts and len(item_abstracts())>0">
                            <span i18n:translate="abstract_available">Abstracts available in</span>
                            <tal:block tal:repeat="abstract item_abstracts">
                                <a href="#"
                                   tal:define="title python:lang_dict[abstract]"
                                   tal:attributes="href string:$item_url/abstract_view?lang=$abstract;
                                                   title abstract"
                                   tal:content="title"></a><span tal:condition="not: repeat/abstract/end">,</span>
                            </tal:block>
                        </div>
                        <div metal:use-macro="here/article_authors/macros/article_authors">
                            A nicely formatted list of authors
                        </div>
                    </li>
                 </tal:items>
            </ol>

            </tal:block>

        </div>
        
        <div metal:use-macro="here/issue_macros/macros/footer">
            Custom footer to add stuff like logos, etc.
        </div>
        
    </tal:main-macro>
</metal:main>

</body>
</html>


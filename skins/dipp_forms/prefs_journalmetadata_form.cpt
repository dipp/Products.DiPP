<html xmlns:tal="http://xml.zope.org/namespaces/tal"
	xmlns:metal="http://xml.zope.org/namespaces/metal"
	metal:use-macro="here/prefs_main_template/macros/master"
    i18n:domain="qdc">
	<metal:block fill-slot="base">
		<base href="" tal:attributes="href python: here.absolute_url() + '/'">
	</metal:block>

	<metal:block fill-slot="top_slot" tal:define="dummy python:request.set('disable_border',1)" />

	<body>


	<div metal:fill-slot="prefs_configlet_main">

          <ul class="contentViews">
            <li class="selected">
              <a href=""
                 tal:attributes="href string:$portal_url/prefs_journalmetadata_form"
                 i18n:translate="journal_metadata">Journal Metadaten</a>
            </li>
            <li>
              <a href="" 
                 tal:attributes="href string:$portal_url/prefs_deadlines_form"
                 i18n:translate="deadlines">Deadlines </a>
            </li>

            <li>
              <a href=""
                 tal:attributes="href string:$portal_url/prefs_mailtemplates_form"
                 i18n:translate="mailtemplates">Mailtemplates</a>
            </li>

            <li>
              <a href=""
                 tal:attributes="href string:$portal_url/prefs_workflowrights_form"
                 i18n:translate="workflowrights">Workflow rights</a>
            </li>
          </ul>

          <div class="contentActions">
              &nbsp;
          </div>

		<h1 i18n:translate="journalmetadata" >Journal Metadata</h1>

        <a href=""
           class="link-parent"
           tal:attributes="href string: $portal_url/plone_control_panel"
           i18n:translate="label_up_to_plone_setup">
          Up to Site Setup
        </a>

        <form tal:attributes="action string:${here/absolute_url}/${template/id};"
              tal:define="errors options/state/getErrors;
                          journalPID python:here.getJournalPID(here);
                          qdc python:here.fedora.getQualifiedDCMetadata(journalPID);
                          available_languages here/portal_properties/metadata_properties/available_languages|nothing;
                          all_languages python:here.fedora.getLanguages()"
              method="post"
              encType="multipart/form-data">


            <input type="hidden" name="form.submitted" value="1" />
            <input type="hidden" name="PID" value="" tal:attributes="value journalPID" />
            
            <div id="qdc-fields">
                <input type="hidden" name="pubType:list" value="journal" />

                
                <div metal:use-macro="here/qdc_macros/macros/title"> Title </div>
                <div metal:use-macro="here/qdc_macros/macros/url"> URL </div>
                <div metal:use-macro="here/qdc_macros/macros/issn"> ISSN </div>
                <div metal:use-macro="here/qdc_macros/macros/language"> Language </div>
                <div metal:use-macro="here/qdc_macros/macros/ddc"> DDC </div>
                <!--<div metal:use-macro="here/qdc_macros/macros/alternative"> alternative </div>-->
                <!--<div metal:use-macro="here/qdc_macros/macros/creatorPerson"> authors </div>-->
                <div metal:use-macro="here/qdc_macros/macros/contributor"> contributors </div>
                <div metal:use-macro="here/qdc_macros/macros/subject"> subject </div>
                <div metal:use-macro="here/qdc_macros/macros/subjectClassified"> subject classified </div>
                <div metal:use-macro="here/qdc_macros/macros/rights"> docType </div>
            </div>

            
            <!-- TITLE -->
            <div class="field"
                 tal:define="error errors/title|nothing;
                             titles python:qdc['title'];
                             titleNumber python:len(titles);
                             newTitleNumber request/newTitleNumber|titleNumber"
                 tal:attributes="class python:test(error, 'field error', 'field')"
                 i18n:domain="qdc">

                <input type="hidden" name="newTitleNumber" value="" tal:attributes="value newTitleNumber"/>
                <input type="hidden" name="titleNumber" value="" tal:attributes="value titleNumber"/>

                <label for="title" i18n:translate="label_short_name">title</label>
                <span class="fieldRequired" title="Required"
                       i18n:attributes="title"
                       i18n:translate="label_required">(Required)</span>
                <div tal:content="error">Validation error output</div>
                <table class="listing">
                    <tr>
                        <th>#</th>
                        <th>Titel</th>
                        <th>Sprache</th>
                    </tr>
                    <tr tal:repeat="title titles">
                        <td tal:content="repeat/title/number">#</td>
                        <td>
                            <input type="text"
                                   name="title_value:list"
                                   size="80"
                                   tal:define="i repeat/title/index;
                                               value python:title['value']"
                                   tal:attributes="value python: here.test('title_value',value,i)" />
                        </td>
                        <td tal:define="i repeat/title/index;
                                        lang python:title['lang']" 
                            tal:content="structure python:here.langList('title_lang:list',here.test('title_lang',lang,i))">
                            Sprachauswahlliste
                            <input type="text"
                                   name="title_lang:list"
                                   tal:define="i repeat/title/index;
                                               value python:title['lang']"
                                   tal:attributes="value python: here.test('title_lang',value,i)" />
                        </td>
                    </tr>
                    <tr tal:condition="python: newTitleNumber > titleNumber"
                        tal:repeat="title python:range(int(titleNumber),int(newTitleNumber))">
                        <tal:block tal:define="number repeat/title/number;
                                               index  repeat/title/index;
                                               no     python:number + titleNumber;
                                               i      python:index + titleNumber">
                            <td tal:content="no">#</td>
                            <td>
                                <input type="text"
                                       name="title_value:list"
                                       size="80"
                                       tal:attributes="value python: here.test('title_value',None,i)" />
                            </td>
                            <td tal:content="structure python:here.langList('title_lang:list',here.test('title_lang',None,i))">
                                Sprachauswahlliste
                                <input type="text"
                                       name="title_lang:list"
                                       tal:attributes="value python: here.test('title_lang',None,i)" />
                            </td>
                        </tal:block>    
                    </tr>
                </table>
                <input class="context"
                       tabindex=""
                       type="submit"
                       name="form.button.addTitle"
                       value="add Title"
                       i18n:attributes="value"
                       tal:attributes="tabindex tabindex/next;
                                       disabled python:test(isLocked, 'disabled', None);" />


            </div>


            <!-- publisher --> 
            <div class="field"
                 tal:define="error errors/publisher|nothing;
                             publishers python:qdc['publisher']"
                 tal:attributes="class python:test(error, 'field error', 'field')"
                 i18n:domain="qdc">

                <label for="publisher" i18n:translate="label_short_name">publisher</label>
                <span class="fieldRequired" title="Required"
                       i18n:attributes="title"
                       i18n:translate="label_required">(Required)</span>
                <div tal:content="error">Validation error output</div>
                <tal:block tal:repeat="publisher publishers">
                        <input type="text" name="publisher:list" value="" tal:attributes="value publisher " >
                </tal:block>


            </div>

 
            <input class="context"
                   tabindex=""
                   type="submit"
                   name="form.button.Save"
                   value="Save"
                   i18n:attributes="value"
                   tal:attributes="tabindex tabindex/next;
                                   disabled python:test(isLocked, 'disabled', None);" />

            <input class="standalone"
                   tabindex=""
                   type="submit"
                   name="form.button.Cancel"
                   value="Cancel"
                   i18n:attributes="value"
                   tal:attributes="tabindex tabindex/next;" />

        </form>
<!--        <tal:block tal:replace="structure request"/>-->
	</div>


</body>
</html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<metal:block fill-slot="top_slot"
             tal:define="dummy python:request.set('disable_border',1)" />

<body>

<tal:block tal:condition="exists: here/portal_skins | nothing"
     tal:replace="nothing">

    <tal:block tal:condition="here/portal_skins/updateSkinCookie | nothing"
               tal:define="dummy here/setupCurrentSkin" />
</tal:block>


<div metal:fill-slot="main">

    <div tal:define="DateTime python:modules['DateTime'].DateTime;
                     Batch python:modules['Products.CMFPlone'].Batch;
                     login_time python:member.getProperty('login_time', DateTime());
                     begin_time python:here.ZopeTime('2000/01/01');
                     validate_email here/validate_email;">

            <metal:block tal:on-error="nothing"
                 tal:define="d_reg python: member.setProperties(last_login_time=login_time);
                             ereg python: member.setProperties(login_time=here.ZopeTime());">
            </metal:block>

            <div tal:condition="python: not(login_time == begin_time and validate_email)">
                <div tal:define="came_from request/came_from|nothing" tal:condition="came_from">
                    <div tal:define="not_allowed python:('login','login_success','login_password','login_failed','login_form','logged_in','logged_out','registered','mail_password','mail_password_form','join_form','require_login');"
                         tal:condition="python:came_from.split('?')[0].split('/')[-1:][0] not in not_allowed">
                         <div tal:define="dummy python: request.RESPONSE.redirect(came_from)" />
                    </div>
                </div>

                <h1 i18n:translate="heading_you_are_now_logged_in">You are now logged in</h1>
                
                <p i18n:translate="description_logged_in_explain" i18n:domain="dipp">
                Notice that the top right bar has changed and an additional navigation menu
                appeared on the left. They will remain as long as you are logged in.
                </p>
                
                <p i18n:translate="description_newbie_pointers" i18n:domain="dipp">
                Depending on your role and permissions the menu on the left contains
                additional functions for your editorial work:
                </p>
                <dl>
                    <dt>
                        <a href="" 
                           tal:attributes="href string:$portal_url/folder_contents" 
                           i18n:translate="">
                               Website Manager</a>
                    </dt>
                    <dd i18n:translate="description_website_manager" i18n:domain="dipp">for managing documents and folders</dd>
                    <dt>
                        <a href="" 
                           tal:attributes="href string:$portal_url/editorial_toolbox" 
                           i18n:translate="">
                               Editorial Toolbox</a>
                    </dt>
                    <dd i18n:translate="description_editorial_toolbox" i18n:domain="dipp">for advanced publication features</dd>
                    <dt>
                        <a href="" 
                           tal:attributes="href string:$portal_url/plone_control_panel" 
                           i18n:translate="">
                               Plone Setup</a>
                    </dt>
                    <dd i18n:translate="description_plone_setup" i18n:domain="dipp">for advanced Site-Management</dd>
                </dl>
                <!--
                <p i18n:translate="description_logged_in_explain">
                Notice that the top right bar has changed. It now
                contains several personalized items. Use these items
                to control your settings and your personal area.
                They will remain as long as you are logged in.
                </p>
                <p i18n:translate="description_newbie_pointers">
                You might want to head over to

                    <span i18n:name="your_folder">
                        <a href=""
                           i18n:translate="description_newbie_pointers_yourfolder_link"
                           tal:define="mystuff python:[a['url'] for a in actions['user'] if a['id']=='mystuff']"
                           tal:condition="mystuff" tal:attributes="href python:mystuff.pop()"
                           >your folder</a>
                    </span>

                and add some content, or

                    <span i18n:name="set_up_your_preferences">
                        <a href=""
                           i18n:translate="description_newbie_pointers_preferences_link"
                           tal:define="prefs python:[a['url'] for a in actions['user'] if a['id']=='preferences']"
                           tal:condition="prefs" tal:attributes="href python:prefs.pop()"
                           >set up your Preferences</a></span>.

                </p>
                -->


		</div>
        <div tal:condition="python: login_time == begin_time and validate_email">
            <metal:block tal:define="dummy python:request.RESPONSE.redirect(portal_url+'/password_form');" />
        </div>
	</div>

</div>

</body>
</html>

